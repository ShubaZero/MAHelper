Set3={	
	name = "Drome of Toxic Shock",
	nR = 4,
	rounds = {			
		--first round
		[1] = {
			nWave =3,
			Waves = {
				[1] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx=35953, posy=50024, posz=99796, texture = "MAHelper/Icons/Signal.dds", X=0.53549695014954,Y=0.51115620136261, c = 1, }, 
						[2] = {posx=33307, posy=50016, posz=100062, texture = "MAHelper/Icons/Signal.dds", X=0.50101417303085,Y=0.46450304985046, c = 1,},
						[3] = {posx=34304, posy=50007, posz=97415, texture = "MAHelper/Icons/Signal.dds", X=0.48073023557663,Y=0.51521295309067, c = 1,},
					},
				},
				[2] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx=35953, posy=50024, posz=99796, texture = "MAHelper/Icons/Signal2.dds",X=0.53549695014954,Y=0.51115620136261, c = 1 }, 
						[2] = {posx=33307, posy=50016, posz=100062, texture = "MAHelper/Icons/Signal2.dds", X=0.50101417303085,Y=0.46450304985046, c = 1},
						[3] = {posx=34304, posy=50007, posz=97415, texture = "MAHelper/Icons/Signal2.dds", X=0.48073023557663,Y=0.51521295309067, c = 1 },
					},
				},
				[3] = {
					nMOB = 4,
					Mobs = {
						[1] = {posx=35953, posy=50024, posz=99796, texture = "MAHelper/Icons/Signal3.dds",X=0.53549695014954,Y=0.51115620136261, c = 1 }, 
						[2] = {posx=33307, posy=50016, posz=100062, texture = "MAHelper/Icons/Signal3.dds", X=0.50101417303085,Y=0.46450304985046, c = 1},
						[3] = {posx=34304, posy=50007, posz=97415, texture = "MAHelper/Icons/Signal3.dds", X=0.48073023557663,Y=0.51521295309067, c = 1 },
						[4] = {posx=34397, posy=49924, posz=95812, texture = "MAHelper/Icons/BossRMael.dds",X=0.50101417303085,Y=0.44219067692757, c = 2 },
					},
				},
			},
		},
		--second round
		[2] = {
			nWave =3,
			Waves = {
				[1] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx=35953, posy=50024, posz=99796, texture = "MAHelper/Icons/Signal.dds",X=0.53549695014954,Y=0.51115620136261, c = 1 }, 
						[2] = {posx=33307, posy=50016, posz=100062, texture = "MAHelper/Icons/Signal.dds", X=0.50101417303085,Y=0.46450304985046, c = 1},
						[3] = {posx=34304, posy=50007, posz=97415, texture = "MAHelper/Icons/Signal.dds", X=0.48073023557663,Y=0.51521295309067, c = 1 },
					},
				},
				[2] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx=35953, posy=50024, posz=99796, texture = "MAHelper/Icons/Signal2.dds",X=0.53549695014954,Y=0.51115620136261, c = 1 }, 
						[2] = {posx=33307, posy=50016, posz=100062, texture = "MAHelper/Icons/Signal2.dds", X=0.50101417303085,Y=0.46450304985046, c = 1},
						[3] = {posx=34304, posy=50007, posz=97415, texture = "MAHelper/Icons/Signal2.dds", X=0.48073023557663,Y=0.51521295309067, c = 1 },
					},
				},
				[3] = {
					nMOB = 4,
					Mobs = {
						[1] = {posx=35953, posy=50024, posz=99796, texture = "MAHelper/Icons/Signal3.dds",X=0.53549695014954,Y=0.51115620136261, c = 1 }, 
						[2] = {posx=33307, posy=50016, posz=100062, texture = "MAHelper/Icons/Signal3.dds", X=0.50101417303085,Y=0.46450304985046, c = 1},
						[3] = {posx=34304, posy=50007, posz=97415, texture = "MAHelper/Icons/Signal3.dds", X=0.48073023557663,Y=0.51521295309067, c = 1 },
						[4] = {posx =34425,posy =49924,posz =101443,X=0.5030425786972,Y=0.54563891887665, texture = "MAHelper/Icons/BossRMael.dds",  c=2},
					},
				},
			},
		},
		--third round
		[3] = {
			nWave =3,
			Waves = {
				[1] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx=35953, posy=50024, posz=99796, texture = "MAHelper/Icons/Signal.dds",X=0.53549695014954,Y=0.51115620136261, c = 1 }, 
						[2] = {posx=33307, posy=50016, posz=100062, texture = "MAHelper/Icons/Signal.dds", X=0.50101417303085,Y=0.46450304985046, c = 1},
						[3] = {posx=34304, posy=50007, posz=97415, texture = "MAHelper/Icons/Signal.dds", X=0.48073023557663,Y=0.51521295309067, c = 1 },
					},
				},
				[2] = {
					nMOB = 3,
					Mobs = {
						[1] = {posx=35953, posy=50024, posz=99796, texture = "MAHelper/Icons/Signal2.dds",X=0.53549695014954,Y=0.51115620136261, c = 1 }, 
						[2] = {posx=33307, posy=50016, posz=100062, texture = "MAHelper/Icons/Signal2.dds", X=0.50101417303085,Y=0.46450304985046, c = 1},
						[3] = {posx=34304, posy=50007, posz=97415, texture = "MAHelper/Icons/Signal2.dds", X=0.48073023557663,Y=0.51521295309067, c = 1 },
					},
				},
				[3] = {
					nMOB = 4,
					Mobs = {
						[1] = {posx=35953, posy=50024, posz=99796, texture = "MAHelper/Icons/Signal3.dds",X=0.53549695014954,Y=0.51115620136261, c = 1 }, 
						[2] = {posx=33307, posy=50016, posz=100062, texture = "MAHelper/Icons/Signal3.dds", X=0.50101417303085,Y=0.46450304985046, c = 1},
						[3] = {posx=34304, posy=50007, posz=97415, texture = "MAHelper/Icons/Signal3.dds", X=0.48073023557663,Y=0.51521295309067, c = 1 },
						[4] = {posx =31628,posy =50024,posz =98440,X=0.44624745845795,Y=0.48478701710701, texture = "MAHelper/Icons/BossRMael.dds", c = 2},
					},
				},
			},
		},
		--Boss	
		[4] = {
			nWave = 1,
			Waves = {
				[1] = {
					nMOB = 1,
					Mobs = {
						[1] = {posx=31131, posy=49924, posz=99748, texture = "MAHelper/Icons/BossMaelSerpe.dds", X=0.43813386559486,Y=0.51115620136261, c = 3}, 
					},
				},
			},
		},
	},
}

CurrWeave = 1
NumK = 0
CurrStageArena = 1
token = true
function Set3.RegEventsLoader()
	MAHelper.ListAddPosition(1,1)
	EVENT_MANAGER:RegisterForEvent(Set3.name .. "PlayerDeath", EVENT_UNIT_DEATH_STATE_CHANGED, Set3.OnPlayerDeath)
	EVENT_MANAGER:RegisterForEvent(Set3.name .."Announcement", EVENT_DISPLAY_ANNOUNCEMENT, Set3.OnTitleAnnounced)
	EVENT_MANAGER:RegisterForEvent(Set3.name .."kill", EVENT_COMBAT_EVENT, Set3.OnUnitKilled)
	EVENT_MANAGER:AddFilterForEvent(Set3.name .."kill", EVENT_COMBAT_EVENT, REGISTER_FILTER_COMBAT_RESULT, ACTION_RESULT_DIED_XP)
end
function Set3.RegUnloadEvents()
	EVENT_MANAGER:UnregisterForEvent(Set3.name .. "PlayerDeath", EVENT_COMBAT_EVENT, Set3.OnPlayerDeath)
	EVENT_MANAGER:UnregisterForEvent(Set3.name .."Announcement", EVENT_DISPLAY_ANNOUNCEMENT, Set3.OnTitleAnnounced)
	EVENT_MANAGER:UnregisterForEvent(Set3.name .."kill", EVENT_COMBAT_EVENT, Set3.OnUnitKilled)
end

function  Set3.OnTitleAnnounced(eventcode, title)
	NumK = 0
	CurrWeave = 1
	if MAHelper.OnTitleReturnRound(title) >= 1 then
		CurrStageArena = MAHelper.OnTitleReturnRound(title)
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CurrStageArena , 1)
	end
	d("CurrStageArena = " ..CurrStageArena)
end

function  Set3.OnPlayerDeath( eventCode,  unitTag,  isDead)
	if isDead and unitTag == "player" then
		MAHelper.RemoveIcons()
		MAHelper.ListAddPosition(CurrStageArena , 1)
	end
end	

function Set3.OnUnitKilled(eventCode,   result,  isError,  abilityName,  abilityGraphic,   abilityActionSlotType,  sourceName,   sourceType,   targetName,   targetType,  hitValue,   powerType,   damageType,  log,  sourceUnitId,  targetUnitId,  abilityId,  overflow)
	if CurrStageArena == 4 and targetName ~= "Lamia Queen" then
		do return end
	end
	NumK = NumK + 1
	if NumK >= Set3.rounds[CurrStageArena].Waves[CurrWeave].nMOB then
		token = false 
		zo_callLater(function() token = true end, 4000)
		if CurrStageArena == Set3.nR then
			MAHelper.RemoveIcons()
			do return end   
		end
		MAHelper.RemoveIcons()
		CurrWeave = CurrWeave +1
		if CurrWeave <= Set3.rounds[CurrStageArena].nWave then
			NumK = 0
			MAHelper.ListAddPosition(CurrStageArena, CurrWeave)		
		else
			NumK=0
			CurrStageArena = CurrStageArena +1
			if CurrStageArena <= Set3.nR then 			
				MAHelper.ListAddPosition(CurrStageArena, 1)	
			end
		end
	end
end
